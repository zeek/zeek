# @TEST-DOC: Test case for extracting a mail that has non-ascii text in the mail portion of the file.
#
# @TEST-EXEC: zeek -C -b -r $TRACES/smtp/rfc3030-bdat-nonascii.pcap %INPUT
# @TEST-EXEC: zeek-cut -m fuid uid seen_bytes parent_fuid < files.log > files.cut
# @TEST-EXEC: btest-diff files.cut
# @TEST-EXEC: btest-diff --binary extract_files/mail
# @TEST-EXEC: grep -q "[^\x00-\x7f]" extract_files/mail

@load base/files/extract
@load base/protocols/smtp
@load policy/protocols/mime/mime_mail_as_file

event file_over_new_connection(f: fa_file, c: connection, is_orig: bool)
    {
    if (SMTP::is_mime_mail(f))
        {
        Files::add_analyzer(f, Files::ANALYZER_EXTRACT, [$extract_filename="mail"]);
        }
    }
